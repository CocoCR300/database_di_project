<mat-drawer-container fullscreen [hasBackdrop]="true">
    <mat-drawer #sidebar mode="push" position="end" (closed)="bookingDrawerClosed()">
        <h2>Reserva en {{selectedLodging?.name}}</h2>
        <form #bookingForm="ngForm" [formGroup]="bookingFormGroup" (ngSubmit)="submitBooking()">
            <mat-form-field>
                <mat-label>Seleccione las fechas de reserva</mat-label>
                <mat-date-range-input [rangePicker]="picker">
                    <input matStartDate formControlName="startDate" placeholder="Inicio" required>
                    <input matEndDate formControlName="endDate" placeholder="Finalización" required>
                </mat-date-range-input>
                <mat-error *ngIf="bookingFormGroup.get('startDate')?.hasError('required')">La fecha es obligatoria.</mat-error>
                <mat-error *ngIf="bookingFormGroup.get('endDate')?.hasError('required')">La fecha es obligatoria.</mat-error>
                <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-date-range-picker #picker></mat-date-range-picker>
            </mat-form-field>

            <ng-container *ngIf="offersRoomTypes(selectedLodging?.type)">
                <mat-form-field>
                    <mat-label>Tipo de habitación</mat-label>
                    <mat-select formControlName="roomTypeId" required>
                        <mat-option *ngIf="selectedLodging?.roomTypes?.length === 0" disabled>
                            No hay habitaciones disponibles
                        </mat-option>
                        <mat-option *ngFor="let roomType of selectedLodging?.roomTypes" [value]="roomType.id">
                            {{ roomType.name }}
                        </mat-option>
                    </mat-select>
                    <mat-error *ngIf="bookingFormGroup.get('roomTypeId')?.hasError('required')">El tipo de habitación es obligatorio.</mat-error>
                </mat-form-field>
            </ng-container>

            <div *ngIf="selectedRoomTypePrice">
                <p>Precio por noche: {{ selectedRoomTypePrice | currency }}</p>
              </div>
              <div *ngIf="selectedTotalPrice">
                <p>Precio total: {{ selectedTotalPrice | currency }}</p>
            </div>
            

            <button mat-flat-button class="button" type="submit">Realizar reserva</button>
        </form>
    </mat-drawer>
    <mat-drawer-content>
        <div id="title_container">
            <h1>{{title}}</h1>
            <button mat-flat-button *ngIf="isLessor" type="button" (click)="createLodging()">Crear alojamiento</button>
            <mat-form-field>
                <input matInput placeholder="Buscar..." (input)="searchTermChanged($event)">
            </mat-form-field>
        </div>

        <div class="lodgings_container">
            <div *ngFor="let lodging of pagedLodgings" class="lodging_card">
                <img *ngIf="hasPhotos(lodging)" loading="lazy" src="{{prependImagesRoute(lodging)}}" alt="{{lodging.name}}" class="lodging_image">
                <div class="lodging_info">
                    <h2 class="lodging_name">{{ lodging.name }}</h2>
                    <p class="lodging_address">{{ lodging.address }}</p>
                    <p class="lodging_description">{{ lodging.description }}</p>
                    <div class="lodging_details">
                        <span *ngIf="hasRoomTypes(lodging)" class="price_per_night">Precio por noche: {{ lodging.roomTypeMinPrice | currency }} — {{ lodging.roomTypeMaxPrice | currency }}</span>
                        <!--<span class="rooms_available">{{ lodging.available_rooms}} habitaciones disponibles</span>-->
                    </div>
                </div>
                <div class="buttons_container">
                    <button mat-flat-button *ngIf="canBook" (click)="openBookingDrawer(lodging)">{{ isUserLogged ? "Reserva" : "Registrate para reservar" }}</button>
                    <button mat-flat-button *ngIf="isLessor" (click)="editLodging(lodging.id)">Editar</button>
                    <button mat-flat-button *ngIf="canDelete" (click)="deleteLodging(lodging.id)">Eliminar</button>
                </div>
            </div>
        </div>
        <mat-paginator #paginator mat-flat-paginator
            [length]="pagedLodgings.length" [pageSize]="pageSize"
            [pageIndex]="currentPage" [pageSizeOptions]="[5, 10]"
            (page)="pageChanged($event)">
        </mat-paginator>
    </mat-drawer-content>
</mat-drawer-container>
